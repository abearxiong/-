<!DOCTYPE html>
<html lang="zh">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Github Oauth App登录模块 | Abear</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Github Oauth App登录模块" />
<meta name="author" content="abearxiong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="GitHub Oauth App在html页面实现第三方登录，得到access_token，实现获取GitHub中的一些有趣的内容。感觉非要后端不可，因为Github的地址，用ajax或者fetch，都会有跨域问题。" />
<meta property="og:description" content="GitHub Oauth App在html页面实现第三方登录，得到access_token，实现获取GitHub中的一些有趣的内容。感觉非要后端不可，因为Github的地址，用ajax或者fetch，都会有跨域问题。" />
<link rel="canonical" href="http://localhost:4000/github/2019/06/Github-Oauth-App%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97.html" />
<meta property="og:url" content="http://localhost:4000/github/2019/06/Github-Oauth-App%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97.html" />
<meta property="og:site_name" content="Abear" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-22T23:32:45+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Github Oauth App登录模块","url":"http://localhost:4000/github/2019/06/Github-Oauth-App%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97.html","dateModified":"2019-06-22T23:32:45+08:00","datePublished":"2019-06-22T23:32:45+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/github/2019/06/Github-Oauth-App%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97.html"},"author":{"@type":"Person","name":"abearxiong"},"description":"GitHub Oauth App在html页面实现第三方登录，得到access_token，实现获取GitHub中的一些有趣的内容。感觉非要后端不可，因为Github的地址，用ajax或者fetch，都会有跨域问题。","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- cdn -->  <!-- bootstrap -->
<link href="https://cdn.bootcss.com/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Abear" />
  </head>
  <body>  <div class="header-wraper">
      <header class="Header">
        <div class="Header-item">
          <a class="Header-link" href="/">
            <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
          </a>
        </div>
        <div class="Header-item"><input type="text"  /></div>
        <div class="Header-item">
          <a class="Header-link" href="/article">文章</a>
          <a class="Header-link" href="/space">空间</a>
          <a class="Header-link" href="/draft">草稿</a>
          <a class="Header-link" href="/project">计划</a>
          <a class="Header-link" href="/feed.xml">RSS</a>
        </div>
      </header>
  </div><div class="container">
      <div class="home">
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Github Oauth App登录模块</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-06-22T23:32:45+08:00" itemprop="datePublished">Jun 22, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>GitHub 中的具有OAuth Apps，申请后可以具有第三方登录。</p>

<h2 id="oauth-apps">OAuth Apps</h2>

<p><a href="https://github.com/settings/applications/new">New OAuth App</a></p>

<p>通过登录后，可以获取<code class="highlighter-rouge">acess_token</code>,然后根据Apps的权限，实现具体对应的功能。</p>

<h2 id="缘由">缘由</h2>

<p>我想在GitHub page中实现类似gitalk的功能，但是我不需要一些，需要我独特的功能。</p>

<p>我可以通过GitHub page得到issues的内容，和添加issues的内容，然后那个页面和自己在QQ空间中的功能就很类似。自己就可以在自己的小空间实现一个很欢乐的保留和记忆，还有各种标签。通过标签查询，这是一个很有用的日志功能，而别人可以通过issues来做blog，为什么，issues就不能作为一个后端，然后实现我现在需要的功能呢？</p>

<h1 id="如何实现oauth-apps的登陆">如何实现OAuth Apps的登陆</h1>

<p>OAuth Apps第三方登录是一个很简单的事情。条理顺序是</p>

<h3 id="1-申请">1. 申请</h3>

<p>最开始是申请Oauth App，得到client_id和client_secret。</p>

<h3 id="2-get请求">2. Get请求</h3>
<p>发送请求到url是<code class="highlighter-rouge">https://github.com/login/oauth/authorize</code> 。参数内容是client_id=值,redirect_url,scope等等</p>

<p>会返回一个code的url，提取code的值</p>

<h3 id="3-post请求">3. Post请求</h3>
<p>发送请求url是 <code class="highlighter-rouge">https://github.com/login/oauth/access_token</code>。参数内容是client_id,redirect_url,scope,code,client_secret</p>

<p>如果是对的，那么会返回一个access_token，那么就可以通过access_token进行操作好玩的事情了。</p>

<h3 id="一个html就够了">一个html就够了</h3>

<p>所有相应的功能，一个html就够了，但是为了secret保险，那么应该需要一个转发平台，微小的服务，进行把client_secret进行隐藏。我觉得 无服务器云函数是可以实现这一个功能的。</p>

<h3 id="例子">例子</h3>

<p>在一个html中，根据获取的href，进行判断进行的步骤。得到的access_token保存到localStorage进行永久保存，如果保存了，那么相当于是登录的状态。</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>github登录<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
登录登录

<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://github.com/login/oauth/authorize"</span>
        <span class="c1">// let client_id = `ccf21c3104b11fcd9219` // xx-space</span>
        <span class="kd">let</span> <span class="nx">client_id</span> <span class="o">=</span> <span class="s2">`6d1f0f1a67b21e729050`</span> <span class="c1">//xx-space-local-dev</span>
        <span class="kd">let</span> <span class="nx">client_secret</span> <span class="o">=</span> <span class="s2">`22cbbe70c70edb70097236f0b8e51c46b8ac460e`</span>
        <span class="kd">let</span> <span class="nx">redirect_uri</span> <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">)</span>
        <span class="c1">// let redirect_uri = encodeURIComponent("https://abearxiong.github.io/space")</span>
        <span class="c1">// fetch(`${url}?client_id=${client_id}&amp;redirect_uri=${redirect_uri}&amp;scope=public_repo`)</span>
        <span class="kd">let</span> <span class="nx">loginLink</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">url</span><span class="p">}</span><span class="s2">?client_id=</span><span class="p">${</span><span class="nx">client_id</span><span class="p">}</span><span class="s2">&amp;redirect_uri=</span><span class="p">${</span><span class="nx">redirect_uri</span><span class="p">}</span><span class="s2">&amp;scope=public_repo`</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"login"</span><span class="p">,</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">nowHref</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span>
        <span class="kd">let</span> <span class="nx">hasCode</span> <span class="o">=</span> <span class="sr">/code/</span>
        <span class="kd">let</span> <span class="nx">hasAccesssCode</span> <span class="o">=</span> <span class="sr">/access_token/</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">hasCode</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">nowHref</span><span class="p">)){</span>
            <span class="kd">let</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">nowHref</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">"="</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"获得code"</span><span class="p">,</span><span class="nx">code</span><span class="p">)</span>
            <span class="kd">let</span> <span class="nx">url_token</span> <span class="o">=</span> <span class="s2">"https://github.com/login/oauth/access_token"</span>
            <span class="kd">let</span> <span class="nx">getTokenUrl</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">url_token</span><span class="p">}</span><span class="s2">?client_id=</span><span class="p">${</span><span class="nx">client_id</span><span class="p">}</span><span class="s2">&amp;client_secret=</span><span class="p">${</span><span class="nx">client_secret</span><span class="p">}</span><span class="s2">&amp;code=</span><span class="p">${</span><span class="nx">code</span><span class="p">}</span><span class="s2">&amp;redirect_uri=</span><span class="p">${</span><span class="nx">redirect_uri</span><span class="p">}</span><span class="s2">&amp;scope=public_repo`</span> 
            <span class="kd">let</span> <span class="nx">getTokenUrl2</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">url_token</span><span class="p">}</span><span class="s2">?client_id=</span><span class="p">${</span><span class="nx">client_id</span><span class="p">}</span><span class="s2">&amp;client_secret=</span><span class="p">${</span><span class="nx">client_secret</span><span class="p">}</span><span class="s2">&amp;code=</span><span class="p">${</span><span class="nx">code</span><span class="p">}</span><span class="s2">&amp;scope=public_repo`</span> 
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"请求的url："</span><span class="p">,</span><span class="nx">getTokenUrl</span><span class="p">)</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">getTokenUrl</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">hasAccesssCode</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">nowHref</span><span class="p">)){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"获得access token"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">loginLink</span>
        <span class="p">}</span>
    <span class="p">})()</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="问题">问题</h3>

<p>各种跨域问题？ fetch cors，ajax跨域有问题。所以非要服务器，本html是利用直接访问url，就没有跨域问题，但是获取的内容，下到了电脑里面呀？？？？？</p>

  </div><a class="u-url" href="/github/2019/06/Github-Oauth-App%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97.html" hidden></a>
</article>
</div>

    </div><div class="footer">

</div><!--Bootstrap js-->
<script src="/assets/js/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
<!-- Script -->
<script src="/assets/js/main.js"></script>

  </body>

</html>