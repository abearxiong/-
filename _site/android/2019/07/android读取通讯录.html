<!DOCTYPE html>
<html lang="zh">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>android读取通讯录 | Abear</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="android读取通讯录" />
<meta name="author" content="abearxiong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="android获取通讯录的内容，并显示的代码。" />
<meta property="og:description" content="android获取通讯录的内容，并显示的代码。" />
<link rel="canonical" href="http://0.0.0.0:4000/android/2019/07/android%E8%AF%BB%E5%8F%96%E9%80%9A%E8%AE%AF%E5%BD%95.html" />
<meta property="og:url" content="http://0.0.0.0:4000/android/2019/07/android%E8%AF%BB%E5%8F%96%E9%80%9A%E8%AE%AF%E5%BD%95.html" />
<meta property="og:site_name" content="Abear" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-04T23:33:04+08:00" />
<script type="application/ld+json">
{"description":"android获取通讯录的内容，并显示的代码。","@type":"BlogPosting","url":"http://0.0.0.0:4000/android/2019/07/android%E8%AF%BB%E5%8F%96%E9%80%9A%E8%AE%AF%E5%BD%95.html","headline":"android读取通讯录","dateModified":"2019-07-04T23:33:04+08:00","datePublished":"2019-07-04T23:33:04+08:00","author":{"@type":"Person","name":"abearxiong"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/android/2019/07/android%E8%AF%BB%E5%8F%96%E9%80%9A%E8%AE%AF%E5%BD%95.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- cdn -->  <!-- bootstrap -->
<link href="https://cdn.bootcss.com/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="Abear" />
  </head>
  <body>  <div class="header-wraper">
      <header class="Header">
        <div class="Header-item">
          <a class="Header-link" href="/">
            <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
          </a>
        </div>
        <div class="Header-item"><input type="text"  /></div>
        <div class="Header-item">
          <a class="Header-link" href="/article">文章</a>
          <a class="Header-link" href="/space">空间</a>
          <a class="Header-link" href="/draft">草稿</a>
          <a class="Header-link" href="/project">计划</a>
          <a class="Header-link" href="/feed.xml">RSS</a>
          <a class="Header-link" href="/lolChessHelper/">L自走棋</a>
        </div>
      </header>
  </div><div class="container">
      <div class="home">
  <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
      <h1 class="post-title p-name" itemprop="name headline">android读取通讯录</h1>
      <p class="post-meta">
        <time class="dt-published" datetime="2019-07-04T23:33:04+08:00" itemprop="datePublished">Jul 4, 2019
        </time></p>
    </header>

    <div class="post-content e-content" itemprop="articleBody">
      <h2 id="如题">如题</h2>

<p>andorid 中的java代码</p>

<pre><code class="language-android">package me.xiongxiao.readconcact;

import android.Manifest;
import android.content.Context;
import android.content.pm.PackageManager;
import android.database.Cursor;
import android.provider.ContactsContract;
import android.support.annotation.NonNull;
import android.support.v4.app.ActivityCompat;
import android.support.v4.content.ContextCompat;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.telephony.TelephonyManager;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.Toast;

import java.util.ArrayList;
import java.util.List;

public class MainActivity extends AppCompatActivity {

    private ListView listView;
//    private TelephonyManager tm;
    private ArrayAdapter&lt;String&gt; adapter;  //适配器
    List&lt;String&gt; contactList = new ArrayList&lt;String&gt;();  //通讯获取的数据

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        listView = (ListView) findViewById(R.id.contact_listview);
        adapter = new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, contactList);
//        tm = (TelephonyManager) this.getSystemService(Context.TELEPHONY_SERVICE);
        listView.setAdapter(adapter);

        /*获取通讯录数据
         * 1.先判断是否已经有读取通讯录的权限
         * 2.如果没有的话，询问用户，如果有的话，直接读取通讯录的数据*/

        //1
        if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_CONTACTS) != PackageManager.PERMISSION_GRANTED) {
            //未获得权限，询问用户
            ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_CONTACTS}, 1);
        } else {
            //已经权限
            readContacts();
        }
//        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.READ_PHONE_STATE) != PackageManager.PERMISSION_GRANTED) {
//            //未获得权限，询问用户
//            ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_PHONE_STATE}, 2);// TODO: Consider calling
//        } else {
//            readMyPhone();
//        }
    }

    //读取通讯录数据
    public void readContacts() {
        Cursor contactCursor = null;
        try {
            contactCursor = getContentResolver().query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI, null, null, null, null);
            if (contactCursor != null) {
                while (contactCursor.moveToNext()) {
                    //读取通讯录数据
                    String name = contactCursor.getString(contactCursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME));
                    String phoneNumber = contactCursor.getString(contactCursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER));
                    contactList.add(name + "\n" + phoneNumber);
                }
                adapter.notifyDataSetChanged();  //刷新ListView
            }
        } catch (SecurityException e) {
            e.printStackTrace();
        }
    }

//    public void readMyPhone() {
//        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.READ_PHONE_STATE) != PackageManager.PERMISSION_GRANTED) {
//            // TODO: Consider calling
//            Toast.makeText(this, "你不能读取用户电话号码", Toast.LENGTH_SHORT).show();
//            return;
//        }
//        String deviceid = tm.getDeviceId();
//        String tel = tm.getLine1Number();//手机号码
//        String tel2 = tm.getGroupIdLevel1();//手机号码2
//        String imei = tm.getSimSerialNumber();
//        String imsi = tm.getSubscriberId();
//        contactList.add("设备id\n"+deviceid);
//        contactList.add("电话\n"+tel);
//        contactList.add("电话2\n"+tel2);
//        adapter.notifyDataSetChanged();  //刷新ListView
//        Toast.makeText(this, "获取完成", Toast.LENGTH_SHORT).show();
//    }
    //权限选择结果回调
    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
        switch (requestCode) {
            case 1:
            {
                if ( grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED ) {
                    readContacts();
                } else {
                    Toast.makeText(this, "你不能读取用户通讯录", Toast.LENGTH_SHORT).show();
                }
            }
            break;
//            case 2:
//            {
//                if ( grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED ) {
//                    readMyPhone();
//                } else {
//                    Toast.makeText(this, "你不能读取用户", Toast.LENGTH_SHORT).show();
//                }
//            }
//            break;
            default:
                break;
        }
    }
}

</code></pre>

<h2 id="视图">视图</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;ListView
        android:id="@+id/contact_listview"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        tools:layout_editor_absoluteX="116dp"
        tools:layout_editor_absoluteY="0dp"&gt;&lt;/ListView&gt;
</code></pre></div></div>
<h2 id="mainfests权限">mainfests权限</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">package=</span><span class="s">"me.xiongxiao.readconcact"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.READ_CONTACTS"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--获取手机号码--&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.READ_PHONE_STATE"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">"true"</span>
        <span class="na">android:icon=</span><span class="s">"@mipmap/ic_launcher"</span>
        <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
        <span class="na">android:roundIcon=</span><span class="s">"@mipmap/ic_launcher_round"</span>
        <span class="na">android:supportsRtl=</span><span class="s">"true"</span>
        <span class="na">android:theme=</span><span class="s">"@style/AppTheme"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">".MainActivity"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
    <span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</code></pre></div></div>

    </div><a class="u-url" href="/android/2019/07/android%E8%AF%BB%E5%8F%96%E9%80%9A%E8%AE%AF%E5%BD%95.html" hidden></a>
  </article>
</div>
    </div><div class="footer">

</div><!--Bootstrap js-->
<script src="/assets/js/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
<!-- Script -->
<script src="/assets/js/main.js"></script>

  </body>

</html>