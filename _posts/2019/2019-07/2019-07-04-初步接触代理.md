---
layout: post
title: 初步接触代理 
date: 2019-07-04 17:54:15 +0800 
categories: 编程 
tags: ["代理", "nodejs", "http代理"]
notebook: 网络
comments: false
description: 有的时候好奇window的代理位置的设置，和在浏览器中switchyOmega的代理设置中http的设置是为什么，所以我为了验证这一个模块，所以我去寻找了一下如果代理是如何进行代理设置的，然后第二点就是nodejs如果让代理进行转发。
---
## [源码][bg1]
```nodejs
var http = require('http');
var net = require('net');
var url = require('url');

function request(cReq, cRes) {
        var u = url.parse(cReq.url);

        var options = {
                    hostname : u.hostname, 
                    port     : u.port || 80,
                    path     : u.path,       
                    method     : cReq.method,
                    headers     : cReq.headers
                };

        var pReq = http.request(options, function(pRes) {
                    cRes.writeHead(pRes.statusCode, pRes.headers);
                    pRes.pipe(cRes);
                }).on('error', function(e) {
                cRes.end();
            });
        
        cReq.pipe(pReq);
}

function connect(cReq, cSock) {
        var u = url.parse('http://' + cReq.url);

        var pSock = net.connect(u.port, u.hostname, function() {
                    cSock.write('HTTP/1.1 200 Connection Established\r\n\r\n');
                    console.log("cSock",cSock) // 打印一下是啥
                    pSock.pipe(cSock);
                }).on('error', function(e) {
                        cSock.end();
                    });

        cSock.pipe(pSock);
}

http.createServer()
    .on('request', request)
    .on('connect', connect)
    .listen(8888, '0.0.0.0');
```

[bg1]: https://imququ.com/post/web-proxy.html "一个对web代理进行解析的高手的博客网址"